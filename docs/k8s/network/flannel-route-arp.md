在 Flannel 的 `host-gw` 网络模式下，维护 ARP 表的工作由每个节点上的操作系统内核自动处理。Flannel 的守护进程（`flanneld`）负责管理路由表的配置，而 ARP 表的管理则是由操作系统内核根据网络流量动态更新的。

### ARP 表维护机制

在 `host-gw` 模式下，Flannel 将每个 Pod 的网络直接桥接到宿主机的物理网络上，使其能够在三层网络中进行通信。具体来说，`flanneld` 在每个节点上执行以下任务：

1. **配置路由表**：
   - `flanneld` 会为每个节点上的所有 Pod 配置路由表，使得这些 Pod 的 IP 地址可以通过物理网络进行路由。
   - 例如，假设节点 A 上有一个 Pod，其 IP 地址为 `10.244.1.5`，节点 B 上有一个 Pod，其 IP 地址为 `10.244.2.7`。`flanneld` 会在节点 A 和节点 B 的路由表中分别添加到对方节点的路由。

2. **维护 ARP 表**：
   - ARP 表是由操作系统内核根据网络流量动态维护的。每当一个 Pod 需要与另一个 Pod 通信时，操作系统会首先查找 ARP 表，确定目标 IP 地址对应的 MAC 地址。
   - 如果 ARP 表中没有目标 IP 的对应条目，操作系统会发送 ARP 请求，以获取目标 IP 地址的 MAC 地址，并在接收到 ARP 响应后更新 ARP 表。

### 具体操作示例

以下是 Flannel 在 `host-gw` 模式下如何配置和维护网络的一个具体示例：

#### 假设环境

- **节点 A**：IP 地址 `192.168.1.10`
  - Pod A1：IP 地址 `10.244.1.5`
- **节点 B**：IP 地址 `192.168.1.11`
  - Pod B1：IP 地址 `10.244.2.7`

#### 1. 配置路由表

在节点 A 上，`flanneld` 会添加以下路由：
```bash
ip route add 10.244.2.0/24 via 192.168.1.11
```

在节点 B 上，`flanneld` 会添加以下路由：
```bash
ip route add 10.244.1.0/24 via 192.168.1.10
```

#### 2. ARP 表维护

当 Pod A1 需要与 Pod B1 通信时：
1. Pod A1 发送数据包到 Pod B1 的 IP 地址 `10.244.2.7`。
2. 操作系统在节点 A 上查找 ARP 表，发现没有 `10.244.2.7` 的 MAC 地址条目。
3. 节点 A 发送 ARP 请求，询问 `192.168.1.11` 的 MAC 地址。
4. 节点 B 接收到 ARP 请求后，发送 ARP 响应，提供 `192.168.1.11` 的 MAC 地址。
5. 节点 A 更新 ARP 表，添加 `192.168.1.11` 的 MAC 地址条目。
6. 之后，Pod A1 可以通过已更新的 ARP 表将数据包发送到 Pod B1。

### 总结

在 Flannel 的 `host-gw` 模式下：
- **路由表** 由 Flannel 的守护进程 `flanneld` 动态配置和管理。
- **ARP 表** 则由操作系统内核自动维护，根据网络流量动态更新。

这种机制确保了在 `host-gw` 模式下，Pod 间通信的高效性和动态性，同时也简化了网络配置和管理的复杂度。